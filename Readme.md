# Приложение-помощник библиотекаря
## Требуемое для запуска ПО
* Node.js@20.5.1^
* Docker@24.0.5^
## Запуск приложения
1. Открыть репозиторий через cmd 

2. Установить требуемые зависимости
```
npm install
```

3. Запустить Docker
```
docker compose up postgres -d
```
Адрес - **localhost:5432**. 

Таблицы **readers** и **books** при инициализации имеют по 2 записи для проведения интеграционных тестов.

4. Запустить сервер Node.js
```
node bin\www
```
Адрес - **localhost:3000**

## Работа с сервером
Приложение состоит из 3-х таблиц (**readers, books, events**), взаимодействие с ними представлено в виде отправки запросов на соответствующие адреса
### /readers
```
/readers?name=XXX&surname=XXX&id=XXX
```
> name - имя, surname - фамилия, id - идентификатор
* **GET**

**Все параметры являются опциональными.** Если ни один параметр не был введен, выводится вся таблица. Если введенным параметрам соответствует несколько записей в таблице, то они все будут выведены

* **POST**

**Параметр id опционален.** Если параметр **id** не был введен, то происходит добавление записи в таблицу с указанными **name** и **surname**. Если параметр **id** был введен, то происходит редактирование записи по указанному **id**: старые данные меняются на новые **name** и **surname** .

* **DELETE**

**Все параметры являются опциональными.** Если ни один параметр не был введен, удаляются все записи в таблице. Если введенным параметрам соответствует несколько записей в таблице, то они все будут удалены

### /books
```
/books?title=XXX&author=XXX&id=XXX
```
> title - название, author - автор, id - идентификатор
* **GET**

**Все параметры являются опциональными.** Если ни один параметр не был введен, выводится вся таблица. Если введенным параметрам соответствует несколько записей в таблице, то они все будут выведены

* **POST**

**Параметр id опционален.** Если параметр **id** не был введен, то происходит добавление записи в таблицу с указанными **title** и **author**. Если параметр **id** был введен, то происходит редактирование записи по указанному **id**: старые данные меняются на новые **title** и **author** .

* **DELETE**

**Все параметры являются опциональными.** Если ни один параметр не был введен, удаляются все записи в таблице. Если введенным параметрам соответствует несколько записей в таблице, то они все будут удалены


### /events
```
/events?action=XXX&bookid=XXX&readerid=XXX&clear=XXX
```
> action (take/return) - действие (взял/вернул), bookid - идентификатор книги, readerid - идентификатор читателя

**Параметр clear опционален.** Если параметр **clear** не был введен, то происходит добавление записи в таблицу с указанными **action**, **bookid** и **readerid**, а также текущим **timestamp** (дата и время). Если параметр **clear** был введен, то происходит удаление всех записей из таблицы.

### /topBook
```
/topBook?from=XXX&to=XXX
```
> from - начало временного отрезка, to - конец временного отрезка

> **Время вводится в формате "YYYY-MM-DDThh:mm:ss" (без кавычек)**

**Все параметры являются опциональными.** Если ни один параметр не был введен, выводится самая популярная книга за все время (от 1970-01-01T00:00:01 до 2038-01-19T00:00:00). Если параметры были введены, то выводится самая популярная книга на введенном отрезке времени.

### /topReader
```
/topReader?from=XXX&to=XXX
```
> from - начало временного отрезка, to - конец временного отрезка

> **Время вводится в формате "YYYY-MM-DDThh:mm:ss" (без кавычек)**

**Все параметры являются опциональными.** Если ни один параметр не был введен, выводится самый читающий читатель за все время (от 1970-01-01T00:00:01 до 2038-01-19T00:00:00). Если параметры были введены, то выводится самый читающий читатель на введенном отрезке времени.


## Запуск интеграционных тестов

Команда для запуска тестов:
```
npm run test
```
Тесты заключаются в проверке самого читающего читателя и самой популярной книги с учетом изменения таблицы **events**.